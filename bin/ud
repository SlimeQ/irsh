#!/usr/bin/fish

. lib/opts.fish

opts ri: $argv

set rand
set item 0

set i 1
while test $i -le (count $flags)
    switch $flags[$i]
        case '-r'
            set rand 1
        case '-i'
            set i (math $i+1)
            set item $flags[$i]
    end
    set i (math $i+1)
end

set api 'http://api.urbandictionary.com/v0'

function clean
    tr -d \r | sed '/^\s*$/d'
end

if test -n "$rand"
    curl -s -G $api/random | jq -r ".list[$item]|.word,.definition" | clean
else
    curl -s -G $api/define --data-urlencode "term=$pos" |\
        jq -r ".list[$item].definition" | clean
end
