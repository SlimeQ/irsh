#!/usr/bin/fish

set self (basename (status -f))
argparse -n$self 'n/words=!_validate_int --min 0 --max 15' -- $argv >/dev/null ^&1
or begin
    printf "%s: Invalid commandline" $self >&2
    exit 1
end

if not set -q argv[1]
    printf "%s: Invalid commandline" $self >&2
    exit 1
end

if set -q _flag_n
    set words $_flag_n
else
    set words (math (random)%5+5)
end

set source (lib/path $argv[1])

if test ! -f $source
    printf '%s: %s: File not found' $self $source >&2
    exit 1
end

function corpus
    cat -- $source | tr '-' ' '
end

for i in (seq $words)
     corpus | grep ' ' | sort -R | head -1 | \
        awk '{ srand(); printf "%s ", $(int(rand()*100)%(NF-1)+1); }'
end

corpus | sort -R | head -1 | awk '{ print $(NF) }'
